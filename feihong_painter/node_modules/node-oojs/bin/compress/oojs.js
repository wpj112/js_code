!function(){var t={name:"oojs",namespace:"",classes:{},noop:function(){},$oojs:function(){var t={};if("undefined"!=typeof window&&window&&"undefined"!=typeof document&&document?(this.runtime="browser",t.global=window):(this.runtime="node",t.global=global),t.proxyName="proxy",t.path="node"===this.runtime?process.cwd()+"/src/":"/src/","undefined"!=typeof $oojs_config)for(var e in $oojs_config)e&&$oojs_config.hasOwnProperty(e)&&(t[e]=$oojs_config[e]);this.global=t.global,t.proxyName&&(Function.prototype[t.proxyName]=this.proxy),this.setPath(t.path),this.global.oojs=this.global.oojs||this},path:{},pathCache:{},getPath:function(t){var e=t?t.split("."):!1,s=this.path;if(e)for(var i=0,r=e.length;r>i;i++){var n=e[i].toLowerCase();if(!s[n])break;s=s[n]}return s.pathValue},setPath:function(t,e){var s=this.path;if("object"!=typeof t){if(e)for(var i=t.split("."),r=0,n=i.length;n>r;r++){var o=i[r].toLowerCase();s[o]=s[o]||{pathValue:s.pathValue},s=s[o]}else e=t;s.pathValue=e,this.pathCache={}}else for(var a in t)a&&t.hasOwnProperty(a)&&this.setPath(a,t[a])},getClassPath:function(t){if(!this.pathCache[t]){this.pathCache[t]=this.getPath(t)+t.replace(/\./gi,"/")+".js";var e=this.getPath(t),s=e.length-1;e.lastIndexOf("\\")!==s&&e.lastIndexOf("/")!==s&&(e+="/"),this.pathCache[t]=e+t.replace(/\./gi,"/")+".js"}return this.pathCache[t]},loadDeps:function(t,e){e=e||{};var s=t.__deps,i=(t.__namespace,[]);for(var r in s)if(s.hasOwnProperty(r)&&s[r]){var n;if("string"!=typeof s[r]?(t[r]=s[r],t[r]&&t[r].__name&&(n=t[r].__full)):(n=s[r],t[r]=this.find(n)),!n||e[n])continue;if(e[n]=!0,t[r])t[r].__deps&&(i=i.concat(this.loadDeps(t[r],e)));else{if("node"===this.runtime)try{t[r]=require(this.getClassPath(n))}catch(o){i.push(n)}t[r]||i.push(n)}}return i},fastClone:function(t){var e=function(){};e.prototype=t;var s=new e;return s},deepClone:function(t,e){"number"!=typeof e&&(e=10);var s,i=e-1;if(e>0)if(t instanceof Date)s=new Date,s.setTime(t.getTime());else if(t instanceof Array){s=[];for(var r=0,n=t.length;n>r;r++)s[r]=this.deepClone(t[r],i)}else if("object"==typeof t){s={};for(var o in t)if(t.hasOwnProperty(o)){var a=t[o];s[o]=this.deepClone(a,i)}}else s=t;else s=t;return s},proxy:function(t,e){var s=Array.prototype.slice.apply(arguments),i=s.shift(),r="function"==typeof this?this:s.shift();return function(){var t=Array.prototype.slice.apply(arguments);return r.apply(i,t.concat(s))}},find:function(t){var e,s=t.split(".");e=this.classes[s[0]];for(var i=1,r=s.length;r>i;i++){if(!e||!e[s[i]]){e=null;break}e=e[s[i]]}return e},reload:function(t){var e=this.find(t);if(e)if(e.__registed=!1,"node"===this.runtime){var s=this.getClassPath(t);delete require.cache[require.resolve(s)],e=require(s)}else e=this.define(e);else e=this.using(t);return e},create:function(t,e,s,i,r,n){"string"==typeof t&&(t=this.using(t));var o=new t.__constructor(e,s,i,r,n);return o},using:function(t){var e=this.find(t);return e||"node"===this.runtime&&(require(this.getClassPath(t)),e=this.find(t)),e},define:function(t){var e=t.name||"__tempName",s=t.namespace||"";t.__name=e,t.__namespace=s,t.__full=s.length>1?s+"."+e:e,t.__deps=t.deps,t.__oojs=this,t.__constructor=function(t,e,s,i,r){if(this.__clones&&this.__clones.length>0)for(var n=0,o=this.__clones.length;o>n;n++){var a=this.__clones[n];this[a]=this.__oojs.deepClone(this[a])}this.__constructorSource(t,e,s,i,r)},t.__constructorSource=t[e]||this.noop,t.__staticSource=t["$"+e]||this.noop,t.__staticUpdate=function(){var e=[];for(var s in this)if(this.hasOwnProperty(s)){var i=this[s];"object"!=typeof i||null===i||"deps"===s||0===s.indexOf("__")||t.__deps&&t.__deps[s]||e.push(s)}this.__clones=e,this.__constructor.prototype=this},t.__static=function(){this.__staticSource(),this.__staticUpdate()};for(var i,r=!1,n=!1,o=s.split("."),a=o.length,h=this.classes,c=0;a>c;c++)i=o[c],i&&(h[i]=h[i]||{},h=h[i]);h[e]=h[e]||{};var l=h;if(h=h[e],h.__name&&h.__registed){if(h.__registed){r=!0;for(var u in t)u&&t.hasOwnProperty(u)&&("undefined"==typeof h[u]||h[u]===this.noop)&&(n=!0,h[u]=t[u])}}else t.__registed=!0,l[e]=t;if(t=l[e],!r||n){var f=this.loadDeps(t);if(f.length>0){if(this.loader=this.loader||this.using("oojs.loader"),"browser"!==this.runtime||!this.loader)throw new Error('class "'+t.name+'" loadDeps error:'+f.join(","));this.loader.loadDepsBrowser(t,f)}else t.__static()}return"node"===this.runtime&&arguments.callee.caller.arguments[2]&&(arguments.callee.caller.arguments[2].exports=t),t}};t.define(t)}(),oojs.define({name:"event",namespace:"oojs",eventList:null,groupList:null,$event:function(){},event:function(){this.eventList={},this.groupList={},this.eventGroupIndexer={}},createCallback:function(t,e,s){return t="undefined"!=typeof t?t:function(){},e="undefined"!=typeof e?e:-1,s="undefined"!=typeof s?s:0,{callback:t,data:null,needTimes:e,emitTimes:s}},createEvent:function(t){var e={name:t,callbacks:[],callbackData:[],emitData:[],status:!1,groups:{}};return e},createGroup:function(t){var e={name:t,callbacks:[],callbackData:[],emitData:[],status:!1,events:{},previousGroups:{},afterGroups:{}};return e},bind:function(t,e,s){var i=this.eventList[t]=this.eventList[t]||this.createEvent(t);if(i.callbacks.push(this.createCallback(e,s)),i.status&&i.emitData.length){for(var r=0,n=i.emitData.length;n>r;r++)this.emit(i.name,i.emitData[r]);i.emitData=[]}return this},unbind:function(t,e){if(t||e){var s=this.eventList[t];if(s&&s.callbacks&&s.callbacks.length)for(var i=0,r=s.callbacks.length;r>i;i++)e?s.callbacks[i].callback===e&&(s.callbacks[i].callback=null,s.callbacks[i].needTimes=0):(s.callbacks[i].callback=null,s.callbacks[i].needTimes=0)}else for(var n in this.eventList)n&&this.eventList[n]&&this.eventList.hasOwnProperty(n)&&this.unbind(n)},emit:function(t,e){var s=this.eventList[t]=this.eventList[t]||this.createEvent(t);if(s.status=!0,s.callbacks&&s.callbacks.length){if(s.callbacks&&s.callbacks.length)for(var i=0,r=s.callbacks.length;r>i;i++){var n=s.callbacks[i],o=n.callback,a=!1;-1===n.needTimes?a=!0:n.needTimes>0&&n.emitTimes<n.needTimes&&(a=!0),n.emitTimes++,a&&o&&(n.data=o(e))}}else s.emitData.push(e);for(var h in s.groups)h&&s.groups.hasOwnProperty(h)&&s.groups[h]&&this.groupEmit(h);return this},group:function(t,e,s,i){var r=this.groupList[t]=this.groupList[t]||this.createGroup(t);if(s){s=s instanceof Array?s:[s];for(var n=0,o=s.length;o>n;n++)r.callbacks.push(this.createCallback(s[n],i))}var a;e="string"==typeof e?[e]:e;for(var n=0,o=e.length;o>n;n++)if(a=e[n],!r.events[a]){r.status=!1;var h=this.eventList[a]=this.eventList[a]||this.createEvent(a);h.groups[t]=1,r.events[a]=1}return e.length>0&&this.groupEmit(t),this},groupEmit:function(t){var e=this.groupList[t]=this.groupList[t]||this.createGroup(t),s=e.afterGroups,i=!0;for(var r in s)r&&s.hasOwnProperty(r)&&this.groupList[r]&&(this.groupList[r].status||(i=!1));if(!i)return this;var n,o=e.events,a=!0;for(var h in o)if(h&&o.hasOwnProperty(h)&&o[h]&&(n=this.eventList[h]=this.eventList[h]||this.createEvent(h),!n.status)){a=!1;break}if(a){e.status=!0;var c={};for(var h in o)if(h&&o.hasOwnProperty(h)&&o[h]){var l=this.eventList[h].callbacks;c[h]=[];for(var u=0,f=l.length;f>u;u++)c[h].push(l[u].data);1===c[h].length&&(c[h]=c[h][0])}if(e.callbacks&&e.callbacks.length)for(var u=0,f=e.callbacks.length;f>u;u++){var p=e.callbacks[u],v=p.callback,d=!1;-1===p.needTimes?d=!0:p.needTimes>0&&p.emitTimes<p.needTimes&&(d=!0),p.emitTimes++,d&&v&&(p.data=v(c))}var g=e.previousGroups;for(var _ in g)_&&g.hasOwnProperty(_)&&this.groupEmit(_)}return this},queue:function(t,e){for(var s,i,r=Array.prototype.slice.apply(arguments),n=1,o=r.length;o>n;n++){s=r[n-1],i=r[n],s=s instanceof Array?s:[s],i=i instanceof Array?i:[i];for(var a=0,h=s.length;h>a;a++){var t=s[a];this.groupList[t]=this.groupList[t]||this.createGroup(t);for(var c=this.groupList[t],l=0,u=i.length;u>l;l++){var e=i[l];this.groupList[e]=this.groupList[e]||this.createGroup(e);var f=this.groupList[e];c.afterGroups[e]=1,f.previousGroups[t]=1}}}}}),oojs.define({name:"promise",namespace:"oojs",deps:{event:"oojs.event"},promise:function(t){if(this.ev=oojs.create(this.event),t)try{t(oojs.proxy(this,this._resolve),oojs.proxy(this,this._reject))}catch(e){this._reject(e)}},status:"pending",data:null,ev:null,defaultFunc:function(t){return t},_resolve:function(t){if(t&&"function"==typeof t.then){var e=t,s=oojs.proxy(this,function(t){this._resolve(t)}),i=oojs.proxy(this,function(t){this._reject(t)});e.then(s,i)}else if(this.status="fulfilled",this.data=t,this.ev.eventList&&this.ev.eventList.onRejected)try{this.ev.emit("onFulfilled",t)}catch(r){this._reject(r)}},resolve:function(t){var e=oojs.create(this);return e._resolve(t),e},_reject:function(t){return this.status="rejected",this.data=t,this.ev.eventList&&this.ev.eventList.onRejected&&this.ev.emit("onRejected",t),t},reject:function(t){var e=oojs.create(this);return e._reject(t),e},promisify:function(t,e){var s=function(){var s=oojs.create("oojs.promise"),i=Array.prototype.slice.apply(arguments),r=function(t){if(t)this._reject(t);else{var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),this._resolve(e)}};return i.push(oojs.proxy(s,r)),t.apply(e,i),s};return s},then:function(t,e){t=t||this.defaultFunc,e=e||this.defaultFunc;var s=oojs.create("oojs.promise"),i=oojs.proxy(s,function(t){this._resolve(t.onFulfilled)}),r=oojs.proxy(s,function(t){this._reject(t.onRejected)});return this.ev.bind("onFulfilled",t),this.ev.group("onFulfilledGroup","onFulfilled",i),this.ev.bind("onRejected",e),this.ev.group("onRejectedGroup","onRejected",r),"fulfilled"===this.status?setTimeout(oojs.proxy(this,function(){this._resolve(this.data)}),0):"rejected"===this.status&&setTimeout(oojs.proxy(this,function(){this._reject(this.data)}),0),s},"catch":function(t){this.then(null,t)},all:function(t){var e=oojs.create(this),s=oojs.create("oojs.event");s.bind("error",oojs.proxy(e,function(t){this._reject(t)}));for(var i=[],r=0,n=t.length;n>r;r++){var o="event-"+(r+1);i.push(o);var a=t[r];a.__eventName=o,a.allEvent=s,s.bind(o,function(t){return t});var h=function(t){this.allEvent.emit(this.__eventName,t)}.proxy(a),c=function(t){this.allEvent.emit("error",t),this.allEvent.unbind()}.proxy(a);a.then(h,c)}return s.group("all",i,function(t){var e=[];for(var s in t)e.push(t[s]);this._resolve(e)}.proxy(e)),e},race:function(t){var e=oojs.create(this),s=oojs.create("oojs.event");s.bind("success",oojs.proxy(e,function(t){this._resolve(t)})),s.bind("error",oojs.proxy(e,function(t){this._reject(t)}));for(var i=[],r=0,n=t.length;n>r;r++){var o="event-"+(r+1);i.push(o);var a=t[r],h=function(t){this.emit("success",t),this.unbind()}.proxy(s),c=function(t){this.emit("error",t),this.unbind()}.proxy(s);a.then(h,c)}return e}}),oojs.define({name:"loader",namespace:"oojs",deps:{event:"oojs.event"},$loader:function(){this.ev=oojs.create(this.event)},loadScript:function(t,e,s){if("function"==typeof e&&(s=e,e="1.0.0"),e=e||"1.0.0",e&&(t+="?v="+e),s=s||function(){},this.loading=this.loading||{},!this.loading[t]){this.loading[t]=1;var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,i.onload=i.onerror=i.onreadystatechange=function(t){/loaded|complete|undefined/.test(i.readyState)&&(i.onload=i.onerror=i.onreadystatechange=null,i=void 0,s())};var r=document.getElementsByTagName("script")[0];return r.parentNode.insertBefore(i,r),this}},loadDepsBrowser:function(t,e){var s=t.__full;this.ev.groupList[s]||this.ev.group(s,[],function(){oojs.reload(s)});for(var i=0,r=e.length;r>i;i++){var n=e[i];this.ev.eventList[n]||this.ev.bind(n,function(){return!0}),this.ev.group(s,n),this.ev.groupList[n]||(this.ev.group(n,[],function(t,e){oojs.reload(e)}.proxy(this,n)),this.ev.groupList[n].status=!0),this.ev.queue(s,n);var o=oojs.getClassPath(n),a=oojs.proxy(this,function(t){this.ev.emit(t,t)},n);this.loadScript(o,a)}return this}});